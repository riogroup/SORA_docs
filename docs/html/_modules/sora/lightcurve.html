

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>sora.lightcurve &mdash; Stellar Occultation Reduction Analysis develop documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Stellar Occultation Reduction Analysis
          

          
          </a>

          
            
            
              <div class="version">
                0.2.dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Manual:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../goals_updates.html">Goals and Version updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../curiosities.html">Curiosities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../future_linea.html">The future and the LIneA TNO Portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input_output.html">Input and Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora_code.html">SORA Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora_code.html#python-hints-tips-and-tools-for-users-sec-python-hints">Python hints, tips and tools (for users) [Sec:Python_hints]</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html">Ephem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.lightcurve">Lightcurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.observer">Observer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.occultation">Occultation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.prediction">Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.star">Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.body">Body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sora.html#module-sora.extra">Extra</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Stellar Occultation Reduction Analysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>sora.lightcurve</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for sora.lightcurve</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.timeseries</span> <span class="kn">import</span> <span class="n">BoxLeastSquares</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">scsp</span>
<span class="kn">from</span> <span class="nn">scipy.odr</span> <span class="kn">import</span> <span class="n">odrpack</span> <span class="k">as</span> <span class="n">odr</span>
<span class="kn">from</span> <span class="nn">scipy.odr</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">.extra</span> <span class="kn">import</span> <span class="n">ChiSquare</span>
<span class="kn">from</span> <span class="nn">sora.config</span> <span class="kn">import</span> <span class="n">input_tests</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">sora.config.decorators</span> <span class="kn">import</span> <span class="n">deprecated_alias</span>


<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

<div class="viewcode-block" id="calc_fresnel"><a class="viewcode-back" href="../../sora.html#sora.lightcurve.calc_fresnel">[docs]</a><span class="nd">@deprecated_alias</span><span class="p">(</span><span class="n">lambida</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">)</span>  <span class="c1"># remove this line for v1.0</span>
<span class="k">def</span> <span class="nf">calc_fresnel</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">bandpass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculates the Fresnel scale.</span>
<span class="sd">        (Fresnel Scale = square root of half the multiplication of wavelength and object distance.)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        distance  (int, float, array): distances, in km.</span>
<span class="sd">        bandpass  (int, float, array): wavelength, in km.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fresnel_scale  (float, array): Fresnel scale, in km</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bandpass</span><span class="o">*</span><span class="n">distance</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="fit_pol"><a class="viewcode-back" href="../../sora.html#sora.lightcurve.fit_pol">[docs]</a><span class="k">def</span> <span class="nf">fit_pol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fits a n-degree polynom to the data.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        x (array): x-values</span>
<span class="sd">        y (array): y-values</span>
<span class="sd">        deg (int): degree of the polynom</span>

<span class="sd">    Returns:</span>
<span class="sd">        param (array): Array with the fitted values</span>
<span class="sd">        param_err (array): Array with the errors of the fitted values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">polynomial</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
    <span class="n">mydata</span> <span class="o">=</span> <span class="n">odr</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">myodr</span> <span class="o">=</span> <span class="n">odr</span><span class="o">.</span><span class="n">ODR</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">maxit</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">myodr</span><span class="o">.</span><span class="n">set_job</span><span class="p">(</span><span class="n">fit_type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">myodr</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">beta</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">param_err</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">sd_beta</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">param</span><span class="p">,</span> <span class="n">param_err</span></div>


<span class="k">class</span> <span class="nc">LightCurve</span><span class="p">():</span>
    <span class="n">__names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@deprecated_alias</span><span class="p">(</span><span class="n">lambda_0</span><span class="o">=</span><span class="s1">&#39;central_bandpass&#39;</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="o">=</span><span class="s1">&#39;delta_bandpass&#39;</span><span class="p">)</span>  <span class="c1"># remove this line for v1.0</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Defines a Light Curve</span>

<span class="sd">        Parameters:</span>
<span class="sd">            name (str): The name of the LightCurve. (required)</span>
<span class="sd">                Each time an LightCurve object is defined the name must be different.</span>
<span class="sd">            tref (Time,str,float): Instant of reference.</span>
<span class="sd">                Format: Julian Date, string in ISO format or Time object.</span>
<span class="sd">                Required only if LightCurve have input fluxes and given time is not in Julian Date.</span>
<span class="sd">            central_bandpass (int,float): The center band pass of the detector used in observation.</span>
<span class="sd">                Value in microns (not required). Default=0.7</span>
<span class="sd">            delta_bandpass (int,float): The band pass width of the detector used in observation.</span>
<span class="sd">                Value in microns (not required). Default=0.3</span>
<span class="sd">            exptime (int,float): The exposure time of the observation, in seconds.</span>
<span class="sd">                NOT required in cases 2, 3 and 4 below.</span>
<span class="sd">                Required in case 1 below.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            vel (int,float):  velocity in km/s.</span>
<span class="sd">            dist (int,float): object distance in AU.</span>
<span class="sd">            d_star (float):   star diameter, in km.</span>

<span class="sd">        Input data must be one of the 4 options below:</span>

<span class="sd">            1) Input file with time and flux</span>
<span class="sd">                file (str): a file with the time and flux.</span>
<span class="sd">                    A third column with the error in flux can also be given.</span>
<span class="sd">                usecols (int, tuple, array): Which columns to read, with the</span>
<span class="sd">                    first being the time, the seconds the flux and third the flux error [optional].</span>

<span class="sd">            2) IF file is not given:</span>
<span class="sd">                time: time must be a list of times, in seconds from tref,</span>
<span class="sd">                    or Julian Date, or a Time object.</span>
<span class="sd">                flux: flux must be a list of fluxes. It must have the</span>
<span class="sd">                    same lenght as time.</span>
<span class="sd">                dflux: if file not given, dflux must be a list of fluxes errors.</span>
<span class="sd">                    It must have the same lenght as time. (not required)</span>

<span class="sd">            IF time and flux are not given.</span>
<span class="sd">            3) For a positive occultation</span>
<span class="sd">                immersion: The instant of immersion.</span>
<span class="sd">                emersion: The instant of emersion.</span>
<span class="sd">                immersion_err: Immersion time uncertainty, in seconds.</span>
<span class="sd">                emersion_err: Emersion time uncertainty, in seconds.</span>

<span class="sd">            4) For a negative occultation</span>
<span class="sd">                initial_time: The initial time of observation.</span>
<span class="sd">                end_time: The end time of observation.</span>

<span class="sd">        Examples: The user can provide one of the followings:</span>

<span class="sd">            LightCurve(name, flux, time, exptime) # dflux can also be given</span>
<span class="sd">            LightCurve(name, file, exptime) # dflux can also be given</span>
<span class="sd">            LightCurve(name, immersion, immersion_err, emersion, emersion_err)</span>
<span class="sd">            LightCurve(name, initial_time, end_time)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed_kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">,</span> <span class="s1">&#39;emersion_err&#39;</span><span class="p">,</span> <span class="s1">&#39;immersion&#39;</span><span class="p">,</span> <span class="s1">&#39;immersion_err&#39;</span><span class="p">,</span> <span class="s1">&#39;initial_time&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;central_bandpass&#39;</span><span class="p">,</span> <span class="s1">&#39;delta_bandpass&#39;</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">,</span> <span class="s1">&#39;dflux&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;usecols&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">,</span> <span class="s1">&#39;d_star&#39;</span><span class="p">]</span>
        <span class="n">input_tests</span><span class="o">.</span><span class="n">check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">allowed_kwargs</span><span class="o">=</span><span class="n">allowed_kwargs</span><span class="p">)</span>
        <span class="n">input_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;name </span><span class="si">{}</span><span class="s1"> already defined for another LightCurve object. Please choose a different one.&#39;</span><span class="o">.</span>
                             <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;tref&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tref&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;immersion&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">immersion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;immersion&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">immersion_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;immersion_err&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">input_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;emersion&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emersion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emersion_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emersion_err&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">input_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;initial_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;end_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;initial_time&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span>
            <span class="n">input_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_done</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_flux</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No allowed input conditions satisfied. Please refer to the tutorial.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;central_bandpass&#39;</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delta_bandpass&#39;</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fresnel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dlamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">fresnel_scale_1</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">-</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale_2</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">+</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">fresnel_scale_1</span> <span class="o">+</span> <span class="n">fresnel_scale_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">fresnel_scale</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">central_bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delta_bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_tref&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tref</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;LightCurve&#39; object has no attribute &#39;tref&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@tref</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid time format accepted by tref&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">immersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_immersion&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immersion</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The immersion time was not fitted or instanciated.&#39;</span><span class="p">)</span>

    <span class="nd">@immersion</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">immersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">2400000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">immersion</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">immersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> can not be set without a reference time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_immersion</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid time format accepted by immersion&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_emersion&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emersion</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The emersion time was not fitted or instanciated.&#39;</span><span class="p">)</span>

    <span class="nd">@emersion</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">emersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">2400000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emersion</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> can not be set without a reference time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_emersion</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid time format accepted by emersion&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initial_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_initial_time&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;LightCurve&#39; object has no attribute &#39;initial_time&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@initial_time</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">initial_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">2400000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> can not be set without a reference time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initial_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid time format accepted by initial_time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_end_time&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;LightCurve&#39; object has no attribute &#39;end_time&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@end_time</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">2400000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> can not be set without a reference time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_end_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid time format accepted by end_time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_immersion&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_emersion&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Time</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">immersion</span><span class="o">.</span><span class="n">jd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">emersion</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Time</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span><span class="o">.</span><span class="n">jd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="p">)</span><span class="o">.</span><span class="n">sec</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;LightCurve&#39; object has no attribute &#39;time&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names</span>

    <span class="k">def</span> <span class="nf">set_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the flux for the LightCurve</span>

<span class="sd">        Parameters:</span>
<span class="sd">            exptime (int,float): The exposure time of the observation, in seconds (required)</span>
<span class="sd">            file (str): a file with the time and flux in the first and second columns, respectively.</span>
<span class="sd">                A third column with error in flux can also be given.</span>
<span class="sd">            time: if file not given, time must be a list of times, in seconds from tref, or Julian Date,</span>
<span class="sd">                or a Time object.</span>
<span class="sd">            flux: if file not given, flux must be a list of fluxes. It must have the same lenght as time.</span>
<span class="sd">            dflux: if file not given, dflux must be a list of fluxes errors.</span>
<span class="sd">                It must have the same lenght as time.</span>
<span class="sd">            tref (Time,str,float): Instant of reference. It can be in Julian Date, string in ISO format</span>
<span class="sd">                or Time object.</span>
<span class="sd">            usecols (int, tuple, array): Which columns to read, with the</span>
<span class="sd">                    first being the time, the seconds the flux and third the flux error [optional].</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            vel (int,float):  velocity in km/s</span>
<span class="sd">            dist (int,float): object distance in AU</span>
<span class="sd">            d_star (float):   star diameter, in km</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">usecols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;usecols&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">usecols</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;usecols&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">usecols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;usecols should have 2 or 3 values&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flux_obs&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input file must have 2 or 3 columns&#39;</span><span class="p">)</span>
            <span class="n">input_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;flux&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_done</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only one type of input can be given. Please refer to the tutorial.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;time and flux must have the same length&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;dflux&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dflux&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dflux</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dflux must have the same length as flux and time&#39;</span><span class="p">)</span>
            <span class="n">input_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;exptime&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;exptime not defined&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Exposure time can not be zero or negative&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;vel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">vel</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;dist&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dist</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;d_star&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_star_diam</span><span class="p">(</span><span class="n">d_star</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;d_star&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;tref&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tref&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="n">Time</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iso</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; 00:00:00.000&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">time</span> <span class="o">&gt;</span> <span class="mi">2400000</span><span class="p">):</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iso</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; 00:00:00.000&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tref&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tref must be given&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">time</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sec</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Exposure time (</span><span class="si">{:0.4f}</span><span class="s1"> seconds) higher than Cycle time (</span><span class="si">{:0.4f}</span><span class="s1"> seconds)&#39;</span><span class="o">.</span>
                              <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_exptime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exptime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the light curve exposure time</span>

<span class="sd">        Parameters:</span>
<span class="sd">            exptime (int,float): exposure time, in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">exptime</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">exptime</span> <span class="o">=</span> <span class="n">exptime</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">exptime</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Exposure time must be an integer, a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">exptime</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Exposure time must be an integer, a float or an Astropy Unit object&#39;</span><span class="p">)</span>           
        <span class="k">if</span> <span class="n">exptime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Exposure time can not be zero or negative&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span> <span class="o">=</span> <span class="n">exptime</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Exposure time (</span><span class="si">{:0.4f}</span><span class="s1"> seconds) higher than Cycle time (</span><span class="si">{:0.4f}</span><span class="s1"> seconds)&#39;</span><span class="o">.</span>
                              <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">set_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the occultation velocity</span>

<span class="sd">        Parameters:</span>
<span class="sd">            vel (int,float): velocity in km/s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">vel</span> <span class="o">=</span> <span class="n">vel</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;vel must be an integer, a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the object distance</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dist (int,float): object distance in AU</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;dist must be an integer, a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span>

    <span class="k">def</span> <span class="nf">set_star_diam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d_star</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the star diameter</span>

<span class="sd">        Parameters:</span>
<span class="sd">            d_star (float): star diameter, in km</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d_star</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">d_star</span> <span class="o">=</span> <span class="n">d_star</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d_star</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;d_star must be an integer, a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_star</span> <span class="o">=</span> <span class="n">d_star</span>

    <span class="nd">@deprecated_alias</span><span class="p">(</span><span class="n">lambda_0</span><span class="o">=</span><span class="s1">&#39;central_bandpass&#39;</span><span class="p">,</span> <span class="n">delta_lambda</span><span class="o">=</span><span class="s1">&#39;delta_bandpass&#39;</span><span class="p">)</span>  <span class="c1"># remove this line for v1.0</span>
    <span class="k">def</span> <span class="nf">set_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_bandpass</span><span class="p">,</span> <span class="n">delta_bandpass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the filter bandwidth in microns</span>

<span class="sd">        Parameters:</span>
<span class="sd">            central_bandpass (float): center band in microns</span>
<span class="sd">            delta_bandpass (float): bandwidth in microns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">central_bandpass</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">central_bandpass</span> <span class="o">=</span> <span class="n">central_bandpass</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">central_bandpass</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;central_bandpass must be a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span> <span class="o">=</span> <span class="n">central_bandpass</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">delta_bandpass</span><span class="p">)</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
            <span class="n">delta_bandpass</span> <span class="o">=</span> <span class="n">delta_bandpass</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">delta_bandpass</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;delta_bandpass must be a float or an Astropy Unit object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span> <span class="o">=</span> <span class="n">delta_bandpass</span>

    <span class="k">def</span> <span class="nf">calc_magnitude_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag_star</span><span class="p">,</span> <span class="n">mag_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determines the magnitude drop of the occultation</span>

<span class="sd">        Parameters:</span>
<span class="sd">            mag_star (int,float): Star magnitude.</span>
<span class="sd">            mag_obj (int,float): Object apparent magnitude to the date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mag_drop (float): Magnitude drop for the given magnitudes</span>
<span class="sd">            bottom_flux (float): Normalized bottom flux for the given magnitudes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">mag_star</span><span class="o">-</span><span class="n">mag_obj</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)))</span>
        <span class="n">mag_combined</span> <span class="o">=</span> <span class="n">mag_star</span><span class="o">-</span><span class="p">(</span><span class="mf">2.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">contrast</span><span class="p">)))</span>
        <span class="n">mag_drop</span> <span class="o">=</span> <span class="n">mag_obj</span> <span class="o">-</span> <span class="n">mag_combined</span>
        <span class="n">bottom_flux</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">mag_combined</span> <span class="o">-</span> <span class="n">mag_obj</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mag_drop</span> <span class="o">=</span> <span class="n">mag_drop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottom_flux</span> <span class="o">=</span> <span class="n">bottom_flux</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly_deg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flux_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">flux_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the fresnel scale.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            poly_deg (int): degree of the polynom to be fitted</span>
<span class="sd">            mask (array of Bolleans): which values to be fitted</span>
<span class="sd">            flux_min (int,float): event flux to be setted as 0.0</span>
<span class="sd">            flux_max (int,float): baseline flux to be setted as 1.0</span>
<span class="sd">            plot (Bollean): If True plot the steps for visual aid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a mask where the polynomial fit will be done</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Normalization is only possible when a LightCurve is instatiated with time and flux.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_flux</span><span class="p">()</span>
        <span class="n">lc_flux</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">flux_max</span><span class="o">-</span><span class="n">flux_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">preliminar_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_detect</span><span class="p">(</span><span class="n">maximum_duration</span><span class="o">=</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">))</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;emersion_time&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">1.00</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;immersion_time&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">1.00</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span>
            <span class="n">chord</span> <span class="o">=</span> <span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">tmin</span><span class="o">-</span><span class="p">(</span><span class="n">chord</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="o">+</span><span class="p">(</span><span class="n">chord</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">norm_time</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">poly_deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">poly_deg</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_pol</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">flux_poly_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">norm_time</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">flux_poly_model</span> <span class="o">=</span> <span class="n">flux_poly_model</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">norm_time</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">ii</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;k.-&#39;</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">flux_poly_model</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polynomial degree = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">poly_deg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_pol</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">flux_poly_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">norm_time</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">flux_poly_model</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">norm_time</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">ii</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;k.-&#39;</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">flux_poly_model</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polynomial degree = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">p</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_pol</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">nn</span><span class="p">)</span>
                <span class="n">flux_poly_model_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">norm_time</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nn</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">flux_poly_model_new</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">norm_time</span><span class="o">**</span><span class="p">(</span><span class="n">nn</span><span class="o">-</span><span class="n">ii</span><span class="p">))</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">flux_poly_model</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">flux_poly_model_new</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">F</span> <span class="o">&gt;</span> <span class="mf">1.05</span><span class="p">:</span>
                    <span class="n">flux_poly_model</span> <span class="o">=</span> <span class="n">flux_poly_model_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">nn</span>
                    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">lc_flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;k.-&#39;</span><span class="p">)</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm_time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">flux_poly_model</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Polynomial degree = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normalization using a </span><span class="si">{}</span><span class="s1"> degree polynom&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There is no improvement with a </span><span class="si">{}</span><span class="s1"> degree polynom&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="n">lc_flux</span><span class="o">/</span><span class="n">flux_poly_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizer_flux</span> <span class="o">=</span> <span class="n">flux_poly_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizer_mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">reset_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resets flux for original values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_obs</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Reset is only possible when a LightCurve is instatiated with time and flux.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">occ_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">immersion_time</span><span class="p">,</span> <span class="n">emersion_time</span><span class="p">,</span> <span class="n">opacity</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">npt_star</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                  <span class="n">time_resolution_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flux_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flux_max</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the modelled light curve considering fresnel difraction, star diameter and intrumental response.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            immersion_time (int, float): Immersion time, in seconds.</span>
<span class="sd">            emersion_time (int, float): Emersion time, in seconds.</span>
<span class="sd">            opacity (int, float): Opacity. Opaque = 1.0, transparent = 0.0</span>
<span class="sd">            mask (array with Booleans): Mask with True values to be computed</span>
<span class="sd">            npt_star  (int): Number of subdivisions for computing the star size&#39;s effects. Default=12</span>
<span class="sd">            time_resolution_factor (int,float): Steps for fresnel scale used for modelling the light curve.</span>
<span class="sd">                Default=10*fresnel scale.</span>
<span class="sd">            flux_min (int,float): Bottom flux (only object). Default=0.0</span>
<span class="sd">            flux_max (int,float): Base flux (object plus star). Default=1.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Computing the fresnel scale</span>
        <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dlamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
        <span class="n">time_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">fresnel_scale_1</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">-</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale_2</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">+</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">fresnel_scale_1</span> <span class="o">+</span> <span class="n">fresnel_scale_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">time_resolution</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">fresnel_scale</span><span class="o">/</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">]))</span><span class="o">/</span><span class="n">time_resolution_factor</span>

        <span class="c1"># Creating a high resolution curve to compute fresnel difraction, stellar diameter and instrumental integration</span>
        <span class="n">time_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">time_obs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="n">time_obs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="n">time_resolution</span><span class="p">)</span>

        <span class="c1"># Changing X: time (s) to distances in the sky plane (km), considering the tangential velocity (vel in km/s)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time_model</span><span class="o">*</span><span class="n">vel</span>
        <span class="n">x01</span> <span class="o">=</span> <span class="n">immersion_time</span><span class="o">*</span><span class="n">vel</span>
        <span class="n">x02</span> <span class="o">=</span> <span class="n">emersion_time</span><span class="o">*</span><span class="n">vel</span>

        <span class="c1"># Computing fresnel diffraction for the case where the star size is negligenciable</span>
        <span class="n">flux_fresnel_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_1</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="n">flux_fresnel_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_2</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="n">flux_fresnel</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_fresnel_1</span> <span class="o">+</span> <span class="n">flux_fresnel_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">flux_star</span> <span class="o">=</span> <span class="n">flux_fresnel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># Computing fresnel diffraction for the case where the star size is not negligenciable</span>
            <span class="n">resolucao</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="o">/</span><span class="n">npt_star</span>
            <span class="n">flux_star_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_model</span><span class="p">))</span>
            <span class="n">flux_star_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_model</span><span class="p">))</span>
            <span class="c1"># Computing stellar diameter only near the immersion or emersion times</span>
            <span class="n">star_diam</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x01</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x02</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">npt_star</span><span class="p">,</span> <span class="n">npt_star</span><span class="p">)</span><span class="o">*</span><span class="n">resolucao</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">star_diam</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span>
                <span class="n">flux1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_1</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="n">flux2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_2</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="n">flux_star_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeff</span><span class="o">*</span><span class="n">flux1</span><span class="p">)</span><span class="o">/</span><span class="n">coeff</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">flux_star_2</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeff</span><span class="o">*</span><span class="n">flux2</span><span class="p">)</span><span class="o">/</span><span class="n">coeff</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">flux_star</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_star_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">flux_star_2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">flux_inst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">)):</span>
            <span class="n">event_model</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&gt;</span> <span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&lt;</span> <span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">flux_inst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_star</span><span class="p">[</span><span class="n">event_model</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux_inst</span><span class="o">*</span><span class="p">(</span><span class="n">flux_max</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">flux_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_model</span> <span class="o">=</span> <span class="n">time_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_star</span> <span class="o">=</span> <span class="n">flux_star</span><span class="o">*</span><span class="p">(</span><span class="n">flux_max</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">flux_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fresnel</span> <span class="o">=</span> <span class="n">flux_fresnel</span><span class="o">*</span><span class="p">(</span><span class="n">flux_max</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">flux_min</span>
        <span class="n">ev_model</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&gt;</span> <span class="n">immersion_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&lt;</span> <span class="n">emersion_time</span><span class="p">)</span>
        <span class="n">flux_box</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_model</span><span class="p">))</span>
        <span class="n">flux_box</span><span class="p">[</span><span class="n">ev_model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">opacity</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">flux_box</span> <span class="o">=</span> <span class="n">flux_box</span><span class="o">*</span><span class="p">(</span><span class="n">flux_max</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">flux_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_geometric</span> <span class="o">=</span> <span class="n">flux_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseflux</span> <span class="o">=</span> <span class="n">flux_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomflux</span> <span class="o">=</span> <span class="n">flux_min</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">occ_lcfit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Monte Carlo chi square fit for occultations lightcurve.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tmin (int,float): Minimum time to consider in the fit procedure, in seconds</span>
<span class="sd">            tmax (int,float): Maximum time to consider in the fit procedure, in seconds</span>
<span class="sd">            flux_min (int,float): Bottom flux (only object). Default=0.0</span>
<span class="sd">            flux_max (int,float): Base flux (object plus star). Default=1.0</span>
<span class="sd">            immersion_time (int, float): Initial guess for immersion time, in seconds.</span>
<span class="sd">            emersion_time (int, float): Initial guess for emersion time, in seconds.</span>
<span class="sd">            opacity (int, float): Initial guess for opacity. Opaque=1.0, transparent=0.0. Default=1.0</span>
<span class="sd">            delta_t (int, float): Interval to fit immersion or emersion time</span>
<span class="sd">            dopacity (int, float): Interval to fit opacity. Default=0</span>
<span class="sd">            loop (int): Number of tests to be done. Default=10000</span>

<span class="sd">        Returns:</span>
<span class="sd">            chi2 (ChiSquare): ChiSquare object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allowed_kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tmin&#39;</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">,</span> <span class="s1">&#39;flux_min&#39;</span><span class="p">,</span> <span class="s1">&#39;flux_max&#39;</span><span class="p">,</span> <span class="s1">&#39;immersion_time&#39;</span><span class="p">,</span> <span class="s1">&#39;emersion_time&#39;</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;delta_t&#39;</span><span class="p">,</span> <span class="s1">&#39;dopacity&#39;</span><span class="p">,</span> <span class="s1">&#39;loop&#39;</span><span class="p">]</span>
        <span class="n">input_tests</span><span class="o">.</span><span class="n">check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">allowed_kwargs</span><span class="o">=</span><span class="n">allowed_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Fit curve is only possible when a LightCurve is instatiated with time and flux.&#39;</span><span class="p">)</span>
        <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loop&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="n">t_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">immersion_time</span> <span class="o">=</span> <span class="n">tmin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span>
        <span class="n">do_immersion</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">emersion_time</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span>
        <span class="n">do_emersion</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">opacity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">delta_opacity</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">do_opacity</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;immersion_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;emersion_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">preliminar_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_detect</span><span class="p">()</span>
            <span class="n">immersion_time</span> <span class="o">=</span> <span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;immersion_time&#39;</span><span class="p">]</span>
            <span class="n">do_immersion</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">emersion_time</span> <span class="o">=</span> <span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;emersion_time&#39;</span><span class="p">]</span>
            <span class="n">do_emersion</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;time_err&#39;</span><span class="p">]</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">emersion_time</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">immersion_time</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">2</span><span class="o">*</span><span class="n">preliminar_occ</span><span class="p">[</span><span class="s1">&#39;occultation_duration&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">:</span>
                <span class="n">tmax</span> <span class="o">=</span> <span class="n">emersion_time</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span>
                <span class="n">tmin</span> <span class="o">=</span> <span class="n">immersion_time</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span>
        <span class="k">if</span> <span class="s1">&#39;tmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tmax&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;tmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tmin&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;delta_t&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;delta_t&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;immersion_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">immersion_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;immersion_time&#39;</span><span class="p">]</span>
            <span class="n">do_immersion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">t_i</span> <span class="o">=</span> <span class="n">immersion_time</span> <span class="o">+</span> <span class="n">delta_t</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;emersion_time&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">emersion_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;emersion_time&#39;</span><span class="p">]</span>
            <span class="n">do_emersion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">t_e</span> <span class="o">=</span> <span class="n">emersion_time</span> <span class="o">+</span> <span class="n">delta_t</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">tmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">)</span>
        <span class="n">mask_sigma</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">tmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">immersion_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">))</span> <span class="o">+</span>
                      <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">emersion_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">)))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mask_sigma</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;dopacity&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">delta_opacity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dopacity&#39;</span><span class="p">]</span>
            <span class="n">do_opacity</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">opas</span> <span class="o">=</span> <span class="n">opacity</span> <span class="o">+</span> <span class="n">delta_opacity</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">opas</span><span class="p">[</span><span class="n">opas</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">opas</span><span class="p">[</span><span class="n">opas</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">flux_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">flux_max</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;flux_min&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">flux_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flux_min&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;flux_max&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">flux_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flux_max&#39;</span><span class="p">]</span>

        <span class="n">tflag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="n">tflag</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_i</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span>
        <span class="n">t_i</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_e</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span>
        <span class="n">t_e</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span> <span class="o">=</span> <span class="n">tflag</span><span class="p">[</span><span class="n">t_i</span> <span class="o">&gt;</span> <span class="n">t_e</span><span class="p">]</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="mi">999999</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
            <span class="n">model_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__occ_model</span><span class="p">(</span><span class="n">t_i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">t_e</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">opas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mask</span><span class="p">,</span> <span class="n">flux_min</span><span class="o">=</span><span class="n">flux_min</span><span class="p">,</span> <span class="n">flux_max</span><span class="o">=</span><span class="n">flux_max</span><span class="p">)</span>
            <span class="n">chi2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">model_test</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">kkargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">do_immersion</span><span class="p">:</span>
            <span class="n">kkargs</span><span class="p">[</span><span class="s1">&#39;immersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_i</span>
        <span class="k">if</span> <span class="n">do_emersion</span><span class="p">:</span>
            <span class="n">kkargs</span><span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_e</span>
        <span class="k">if</span> <span class="n">do_opacity</span><span class="p">:</span>
            <span class="n">kkargs</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opas</span>
        <span class="n">chisquare</span> <span class="o">=</span> <span class="n">ChiSquare</span><span class="p">(</span><span class="n">chi2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">kkargs</span><span class="p">)</span>
        <span class="n">onesigma</span> <span class="o">=</span> <span class="n">chisquare</span><span class="o">.</span><span class="n">get_nsigma</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;immersion&#39;</span> <span class="ow">in</span> <span class="n">onesigma</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_immersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;immersion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">immersion_err</span> <span class="o">=</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;immersion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">immersion_time</span> <span class="o">=</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;immersion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">immersion_time</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_immersion</span><span class="o">.</span><span class="n">jd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;emersion&#39;</span> <span class="ow">in</span> <span class="n">onesigma</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span> <span class="o">+</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emersion_err</span> <span class="o">=</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">emersion_time</span> <span class="o">=</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;emersion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">emersion_time</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emersion</span><span class="o">.</span><span class="n">jd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;opacity&#39;</span> <span class="ow">in</span> <span class="n">onesigma</span><span class="p">:</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="n">onesigma</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Run occ_model() to save best parameters in the Object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_model</span><span class="p">(</span><span class="n">immersion_time</span><span class="p">,</span> <span class="n">emersion_time</span><span class="p">,</span> <span class="n">opacity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">)),</span>
                       <span class="n">flux_min</span><span class="o">=</span><span class="n">flux_min</span><span class="p">,</span> <span class="n">flux_max</span><span class="o">=</span><span class="n">flux_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lc_sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chisquare</span> <span class="o">=</span> <span class="n">chisquare</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span>
        <span class="k">return</span> <span class="n">chisquare</span>

    <span class="k">def</span> <span class="nf">plot_lc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plots the light curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">):</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;k.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Obs.&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [seconds]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Plotting the light curve is only possible when the &#39;</span>
                             <span class="s1">&#39;Object LightCurve is instatiated with time and flux&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plots the modelled light curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">):</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_geometric</span><span class="p">,</span> <span class="s1">&#39;c-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Geometric&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fresnel</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fresnel&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_star</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Star diam.&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [seconds]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Plotting the model light curve is only possible after the model &#39;</span>
                             <span class="s1">&#39;[LightCurve.occ_model()] or the fit [LightCurve.occ_lcfit()]&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the light curve log to a file</span>

<span class="sd">        Parameters:</span>
<span class="sd">            namefile (str): Filename to save the log</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">namefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">namefile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.log&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">namefile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namefile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the light curve to a file</span>

<span class="sd">        Parameters:</span>
<span class="sd">            namefile (str): Filename to save the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Observational data</span>
        <span class="k">if</span> <span class="n">namefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">namefile</span><span class="p">)</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">namefile</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="p">)</span><span class="o">.</span><span class="n">jd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">])</span>
        <span class="n">colunm_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Time JD&#39;</span><span class="p">,</span> <span class="s1">&#39;Time relative to </span><span class="si">{}</span><span class="s1"> UTC in seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="o">.</span><span class="n">iso</span><span class="p">),</span>
                        <span class="s1">&#39;Observational Flux&#39;</span><span class="p">,</span> <span class="s1">&#39;Modelled Flux&#39;</span><span class="p">,</span> <span class="s1">&#39;Residual O-C&#39;</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%11.8f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.label&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colunm_names</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Column </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># Complete Model</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">):</span>
            <span class="n">data_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="p">)</span><span class="o">.</span><span class="n">jd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_geometric</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">model_fresnel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_star</span><span class="p">])</span>
            <span class="n">colunm_names_model</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Model time JD&#39;</span><span class="p">,</span> <span class="s1">&#39;Model time relative to </span><span class="si">{}</span><span class="s1"> UTC in seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tref</span><span class="o">.</span><span class="n">iso</span><span class="p">),</span>
                                  <span class="s1">&#39;Geometric Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Model with Fresnel diffraction&#39;</span><span class="p">,</span> <span class="s1">&#39;Model with star diameter&#39;</span><span class="p">]</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;model_&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">),</span> <span class="n">data_model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%11.8f</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;model_&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.label&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colunm_names_model</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Column </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">occ_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximum_duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dur_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">snr_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">n_detections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Detects automatically the occultation event in the light curve</span>
<span class="sd">            (detects a &#39;square well transit&#39;)</span>

<span class="sd">        Parameters:</span>
<span class="sd">        (All parameters are optional)</span>
<span class="sd">            maximum_duration (float): Maximum duration of the occultation event. Default: light curve&#39;s time span</span>
<span class="sd">            dur_step (float): Step size to sweep occultation duration event. Default=1/2 of sampling</span>
<span class="sd">            snr_limit (float): Minimum occultation SNR. Default=none</span>
<span class="sd">            n_detections (int): Number of detections regardless the SNR.</span>
<span class="sd">                n_detections is superseded by snr_limit. Default=1</span>
<span class="sd">            plot (boolean): True if output plots are desired.</span>

<span class="sd">        Returns:</span>
<span class="sd">            OrderedDict = An ordered dictionary of :attr:`name`::attr:`value` pairs for each Parameter.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; lc = sora.LightCurve(time=time, flux=flux, exptime=0.0, name=&#39;lc_example&#39;)</span>
<span class="sd">            &gt;&gt;&gt; params = lc.occ_detect()</span>
<span class="sd">            &gt;&gt;&gt; params</span>
<span class="sd">            {&#39;rank&#39;: 1,</span>
<span class="sd">            &#39;occultation_duration&#39;: 40.1384063065052,</span>
<span class="sd">            &#39;central_time&#39;: 7916.773870512843,</span>
<span class="sd">            &#39;immersion_time&#39;: 7896.7046673595905,</span>
<span class="sd">            &#39;emersion_time&#39;: 7936.843073666096,</span>
<span class="sd">            &#39;time_err&#39;: 0.05011036992073059,</span>
<span class="sd">            &#39;depth&#39;: 0.8663887801707082,</span>
<span class="sd">            &#39;depth_err&#39;: 0.10986223384336465,</span>
<span class="sd">            &#39;baseline&#39;: 0.9110181732552853,</span>
<span class="sd">            &#39;baseline_err&#39;: 0.19045768512595365,</span>
<span class="sd">            &#39;snr&#39;: 7.886138392251848,</span>
<span class="sd">            &#39;occ_mask&#39;: array([False, False, False, ..., False, False, False])}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;time and flux must be instantiated to use &#39;</span><span class="p">,</span>
                             <span class="s1">&#39;occ_detect function.&#39;</span><span class="p">)</span>

        <span class="c1"># duration of the light curve</span>
        <span class="n">time_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">maximum_duration</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maximum_duration</span> <span class="o">&gt;</span> <span class="n">time_span</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Occultation duration (maximum_duration=</span><span class="si">{0}</span><span class="s1">) &#39;</span><span class="p">,</span>
                          <span class="s1">&#39;exceeds the time series lenght (</span><span class="si">{1:0.5f}</span><span class="s1">).&#39;</span><span class="p">,</span>
                          <span class="s1">&#39; maximum_duration reset to the time series lenght.&#39;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maximum_duration</span><span class="p">,</span> <span class="n">time_span</span><span class="p">))</span>
            <span class="n">maximum_duration</span> <span class="o">=</span> <span class="n">time_span</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">maximum_duration</span><span class="p">:</span>
            <span class="n">maximum_duration</span> <span class="o">=</span> <span class="n">time_span</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dur_step</span><span class="p">:</span>
            <span class="n">dur_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">dur_step</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The given dur_step is oversampled by a factor &#39;</span><span class="p">,</span>
                          <span class="s1">&#39;of </span><span class="si">{0:0.1f}</span><span class="s1"> and has been reset to half a cycle &#39;</span><span class="p">,</span>
                          <span class="s1">&#39;(</span><span class="si">{1:0.4f}</span><span class="s1">).&#39;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">dur_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
            <span class="n">dur_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">duration_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dur_step</span><span class="p">,</span> <span class="n">maximum_duration</span><span class="p">,</span> <span class="n">dur_step</span><span class="p">)</span>
        <span class="c1"># initial occultation mask (all data points)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># inital detection rank</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">snr_limit</span><span class="p">:</span>
            <span class="c1"># minimum SNR accepted in a detection for multiple search</span>
            <span class="n">snr_value</span> <span class="o">=</span> <span class="n">snr_limit</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">occ0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_bls</span><span class="p">(</span><span class="n">time_span</span><span class="p">,</span> <span class="n">duration_grid</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">*=</span> <span class="o">~</span><span class="n">occ0</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">snr_value</span> <span class="o">&gt;</span> <span class="n">snr_limit</span><span class="p">):</span>
                <span class="n">rank</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">occ1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_bls</span><span class="p">(</span><span class="n">time_span</span><span class="p">,</span> <span class="n">duration_grid</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">occ1</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">snr_limit</span><span class="p">:</span>
                    <span class="n">snr_value</span> <span class="o">=</span> <span class="n">occ1</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">*=</span> <span class="o">~</span><span class="n">occ1</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]</span>
                    <span class="n">occ0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__summarize_bls</span><span class="p">(</span><span class="n">occ0</span><span class="p">,</span> <span class="n">occ1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">snr_value</span> <span class="o">=</span> <span class="n">snr_limit</span>

            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_occ_detect</span><span class="p">(</span><span class="n">occ0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">occ0</span>
        <span class="k">elif</span> <span class="n">n_detections</span><span class="p">:</span>
            <span class="c1"># search the n best fits</span>
            <span class="n">occ0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_bls</span><span class="p">(</span><span class="n">time_span</span><span class="p">,</span> <span class="n">duration_grid</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">*=</span> <span class="o">~</span><span class="n">occ0</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_detections</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">rank</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">occ1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_bls</span><span class="p">(</span><span class="n">time_span</span><span class="p">,</span> <span class="n">duration_grid</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
                                      <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">)</span>
                <span class="n">snr_value</span> <span class="o">=</span> <span class="n">occ1</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">*=</span> <span class="o">~</span><span class="n">occ1</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]</span>
                <span class="n">occ0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__summarize_bls</span><span class="p">(</span><span class="n">occ0</span><span class="p">,</span> <span class="n">occ1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_occ_detect</span><span class="p">(</span><span class="n">occ0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">occ0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># search only the first best fit</span>
            <span class="n">occ0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_bls</span><span class="p">(</span><span class="n">time_span</span><span class="p">,</span> <span class="n">duration_grid</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__plot_occ_detect</span><span class="p">(</span><span class="n">occ0</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">occ0</span>

    <span class="k">def</span> <span class="nf">__plot_occ_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">occ</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># case for multiple detections</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;k.-&#39;</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">trues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]),</span> <span class="n">trues</span><span class="p">),</span>
                        <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rank: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">mask</span> <span class="o">+=</span> <span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

            <span class="n">falses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]),</span> <span class="n">falses</span><span class="p">),</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Baseline&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [seconds]&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># case for single occultation</span>
            <span class="n">trues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">falses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;k.-&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]]),</span> <span class="n">trues</span><span class="p">),</span>
                    <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Occultation&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">~</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="o">~</span><span class="n">occ</span><span class="p">[</span><span class="s1">&#39;occ_mask&#39;</span><span class="p">]]),</span> <span class="n">falses</span><span class="p">),</span>
                    <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Baseline&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [seconds]&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__run_bls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">per_grid</span><span class="p">,</span> <span class="n">dur_grid</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Private function to find the best box fit suitable to the data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># object with no occultation mask</span>
        <span class="n">mskmodel</span> <span class="o">=</span> <span class="n">BoxLeastSquares</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dflux</span><span class="p">)</span>
        <span class="c1"># if there is no dflux array, reset it to None in case of</span>
        <span class="c1"># using a mask</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfluxmask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfluxmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dflux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># object with occultation mask</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">BoxLeastSquares</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
                                    <span class="n">dy</span><span class="o">=</span><span class="n">dfluxmask</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">mskmodel</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">per_grid</span><span class="p">,</span> <span class="n">dur_grid</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;snr&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fast&#39;</span><span class="p">)</span>
        <span class="c1"># statistics of the BLS fit</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">compute_stats</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">transit_time</span><span class="p">)</span>
        <span class="c1"># occultation mask of the event with respect to all data</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">mskmodel</span><span class="o">.</span><span class="n">transit_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                                         <span class="n">r</span><span class="o">.</span><span class="n">transit_time</span><span class="p">)</span>
        <span class="c1"># parameters computation for clarity purposes</span>
        <span class="n">occultation_duration</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">central_time</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;transit_times&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">immersion_time</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;transit_times&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">emersion_time</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;transit_times&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">time_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="o">~</span><span class="n">occ_mask</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="n">depth_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="o">~</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="n">baseline_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="o">~</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># If there is only one measurement during the occultation it will</span>
        <span class="c1"># use the baseline_err to compute SNR, otherwise it will use depth_err</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">occ_mask</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="n">depth</span><span class="o">/</span><span class="n">baseline_err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="n">depth</span><span class="o">/</span><span class="n">depth_err</span>

        <span class="c1"># define rank</span>
        <span class="k">if</span> <span class="n">rank</span><span class="p">:</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">,</span>
                <span class="s1">&#39;occultation_duration&#39;</span><span class="p">:</span> <span class="n">occultation_duration</span><span class="p">,</span>
                <span class="s1">&#39;central_time&#39;</span><span class="p">:</span> <span class="n">central_time</span><span class="p">,</span>
                <span class="s1">&#39;immersion_time&#39;</span><span class="p">:</span> <span class="n">immersion_time</span><span class="p">,</span>
                <span class="s1">&#39;emersion_time&#39;</span><span class="p">:</span> <span class="n">emersion_time</span><span class="p">,</span>
                <span class="s1">&#39;time_err&#39;</span><span class="p">:</span> <span class="n">time_err</span><span class="p">,</span>
                <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="n">depth</span><span class="p">,</span> <span class="s1">&#39;depth_err&#39;</span><span class="p">:</span> <span class="n">depth_err</span><span class="p">,</span>
                <span class="s1">&#39;baseline&#39;</span><span class="p">:</span> <span class="n">baseline</span><span class="p">,</span> <span class="s1">&#39;baseline_err&#39;</span><span class="p">:</span> <span class="n">baseline_err</span><span class="p">,</span>
                <span class="s1">&#39;snr&#39;</span><span class="p">:</span> <span class="n">snr</span><span class="p">,</span> <span class="s1">&#39;occ_mask&#39;</span><span class="p">:</span> <span class="n">occ_mask</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__summarize_bls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Private function to merge dictionaries returned by BLS and</span>
<span class="sd">            to keep values of common keys in list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict3</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;occ_mask&#39;</span><span class="p">:</span>
                <span class="n">sz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">sz</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">sz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sz</span><span class="p">):</span>
                        <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">dict3</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dict3</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dict3</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dict3</span>

    <span class="k">def</span> <span class="nf">__bar_fresnel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X01</span><span class="p">,</span> <span class="n">X02</span><span class="p">,</span> <span class="n">fresnel_scale</span><span class="p">,</span> <span class="n">opacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the modelled light curve considering fresnel difraction.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            X (array): Array with time values converted in km using the event velocity.</span>
<span class="sd">            X01 (int, float): Immersion time converted in km using the event velocity.</span>
<span class="sd">            X02 (int, float): Emersion time converted in km using the event velocity.</span>
<span class="sd">            fresnel_scale (int, float): Fresnel scale, in km.</span>
<span class="sd">            opacity (int, float): Opacity. Opaque = 1.0, transparent = 0.0</span>

<span class="sd">        Returns:</span>
<span class="sd">            flux_fresnel (array): the light curve with fresnel diffraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Converting from km to units of fresnel scale</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="o">/</span><span class="n">fresnel_scale</span>
        <span class="n">x01</span> <span class="o">=</span> <span class="n">X01</span><span class="o">/</span><span class="n">fresnel_scale</span>
        <span class="n">x02</span> <span class="o">=</span> <span class="n">X02</span><span class="o">/</span><span class="n">fresnel_scale</span>
        <span class="c1"># Fresnel difraction parameters</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x01</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x02</span>
        <span class="n">s1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">scsp</span><span class="o">.</span><span class="n">fresnel</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">s2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">scsp</span><span class="o">.</span><span class="n">fresnel</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span>
        <span class="n">r_ampli</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">cc</span><span class="o">+</span><span class="n">ss</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">opacity</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">i_ampli</span> <span class="o">=</span> <span class="p">(</span><span class="n">cc</span><span class="o">-</span><span class="n">ss</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">opacity</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="c1"># Determining the flux considering fresnel difraction</span>
        <span class="n">flux_fresnel</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">r_ampli</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i_ampli</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">flux_fresnel</span>

    <span class="k">def</span> <span class="nf">__occ_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">immersion_time</span><span class="p">,</span> <span class="n">emersion_time</span><span class="p">,</span> <span class="n">opacity</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">npt_star</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                    <span class="n">time_resolution_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flux_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">flux_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Private function returns the modelled light curve considering fresnel difraction,</span>
<span class="sd">            star diameter and intrumental response, intended for fitting inside the self.occ_lcfit().</span>

<span class="sd">        Parameters:</span>
<span class="sd">            immersion_time (int, float): Immersion time, in seconds.</span>
<span class="sd">            emersion_time (int, float): Emersion time, in seconds.</span>
<span class="sd">            opacity (int, float): Opacity. Opaque = 1.0, transparent = 0.0.</span>
<span class="sd">            mask (array with Booleans): Mask with True values to be computed</span>
<span class="sd">            npt_star (int): Number of subdivisions for computing the star size&#39;s effects. Default=12</span>
<span class="sd">            time_resolution_factor (int,float): Steps for fresnel scale used for modelling the light curve.</span>
<span class="sd">                Default=10*fresnel scale.</span>
<span class="sd">            flux_min (int,float): Bottom flux (only object). Default=0.0</span>
<span class="sd">            flux_max (int,float): Base flux (object plus star). Default=1.0</span>

<span class="sd">        Returns:</span>
<span class="sd">            flux_inst (array): Modelled Instrumental light flux.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Computing the fresnel scale</span>
        <span class="n">lamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dlamb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micrometer</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
        <span class="n">time_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">fresnel_scale_1</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">-</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale_2</span> <span class="o">=</span> <span class="n">calc_fresnel</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">lamb</span><span class="o">+</span><span class="n">dlamb</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fresnel_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">fresnel_scale_1</span> <span class="o">+</span> <span class="n">fresnel_scale_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">time_resolution</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">fresnel_scale</span><span class="o">/</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">]))</span><span class="o">/</span><span class="n">time_resolution_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_resolution</span> <span class="o">=</span> <span class="n">time_resolution</span>

        <span class="c1"># Creating a high resolution curve to compute fresnel difraction, stellar diameter and instrumental integration</span>
        <span class="n">time_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">time_obs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="n">time_obs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="n">time_resolution</span><span class="p">)</span>

        <span class="c1"># Changing X: time (s) to distances in the sky plane (km), considering the tangential velocity (vel in km/s)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time_model</span><span class="o">*</span><span class="n">vel</span>
        <span class="n">x01</span> <span class="o">=</span> <span class="n">immersion_time</span><span class="o">*</span><span class="n">vel</span>
        <span class="n">x02</span> <span class="o">=</span> <span class="n">emersion_time</span><span class="o">*</span><span class="n">vel</span>

        <span class="c1"># Computing fresnel diffraction for the case where the star size is negligenciable</span>
        <span class="n">flux_fresnel_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_1</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="n">flux_fresnel_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_2</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
        <span class="n">flux_fresnel</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_fresnel_1</span> <span class="o">+</span> <span class="n">flux_fresnel_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">flux_star</span> <span class="o">=</span> <span class="n">flux_fresnel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># Computing fresnel diffraction for the case where the star size is not negligenciable</span>
            <span class="n">resolucao</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="o">/</span><span class="n">npt_star</span>
            <span class="n">flux_star_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_model</span><span class="p">))</span>
            <span class="n">flux_star_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_model</span><span class="p">))</span>
            <span class="c1"># Computing stellar diameter only near the immersion or emersion times</span>
            <span class="n">star_diam</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x01</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x02</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">npt_star</span><span class="p">,</span> <span class="n">npt_star</span><span class="p">)</span><span class="o">*</span><span class="n">resolucao</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">star_diam</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span>
                <span class="n">flux1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_1</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="n">flux2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bar_fresnel</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">x01</span><span class="p">,</span> <span class="n">x02</span><span class="p">,</span> <span class="n">fresnel_scale_2</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
                <span class="n">flux_star_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeff</span><span class="o">*</span><span class="n">flux1</span><span class="p">)</span><span class="o">/</span><span class="n">coeff</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">flux_star_2</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeff</span><span class="o">*</span><span class="n">flux2</span><span class="p">)</span><span class="o">/</span><span class="n">coeff</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">flux_star</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_star_1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">flux_star_2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">flux_inst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">)):</span>
            <span class="n">event_model</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&gt;</span> <span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">time_model</span> <span class="o">&lt;</span> <span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">flux_inst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_star</span><span class="p">[</span><span class="n">event_model</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">flux_inst</span><span class="o">*</span><span class="p">(</span><span class="n">flux_max</span> <span class="o">-</span> <span class="n">flux_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">flux_min</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of the LightCurve Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;Light curve name: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;Initial time: </span><span class="si">{}</span><span class="s1"> UTC</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;End time:     </span><span class="si">{}</span><span class="s1"> UTC</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Duration:     </span><span class="si">{:.3f}</span><span class="s1"> minutes</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span><span class="o">.</span><span class="n">iso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">iso</span><span class="p">,</span>
                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_time</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">))</span>
                       <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Time offset:  </span><span class="si">{:.3f}</span><span class="s1"> seconds</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Exposure time:    </span><span class="si">{:.4f}</span><span class="s1"> seconds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Cycle time:       </span><span class="si">{:.4f}</span><span class="s1"> seconds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Num. data points: </span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Object LightCurve was not instantiated with time and flux.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;Bandpass:             </span><span class="si">{:.3f}</span><span class="s1"> +/- </span><span class="si">{:.3f}</span><span class="s1"> microns</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Object Distance:      </span><span class="si">{:.2f}</span><span class="s1"> AU</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Used shadow velocity: </span><span class="si">{:.3f}</span><span class="s1"> km/s</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Fresnel scale:        </span><span class="si">{:.3f}</span><span class="s1"> seconds or </span><span class="si">{:.2f}</span><span class="s1"> km</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Stellar size effect:  </span><span class="si">{:.3f}</span><span class="s1"> seconds or </span><span class="si">{:.2f}</span><span class="s1"> km</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_lambda</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">fresnel_scale</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresnel_scale</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_star</span><span class="p">)</span>
                       <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">There is no occultation associated with this light curve.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;Inst. response:       </span><span class="si">{:.3f}</span><span class="s1"> seconds or </span><span class="si">{:.2f}</span><span class="s1"> km</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Dead time effect:     </span><span class="si">{:.3f}</span><span class="s1"> seconds or </span><span class="si">{:.2f}</span><span class="s1"> km</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Model resolution:     </span><span class="si">{:.3f}</span><span class="s1"> seconds or </span><span class="si">{:.2f}</span><span class="s1"> km</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Modelled baseflux:    </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Modelled bottomflux:  </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Light curve sigma:    </span><span class="si">{:.3f}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">,</span>
                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exptime</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_resolution</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">model_resolution</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseflux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomflux</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">lc_sigma</span><span class="p">)</span>
                       <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Object LightCurve model was not fitted.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;Immersion time: </span><span class="si">{}</span><span class="s1"> UTC +/- </span><span class="si">{:.3f}</span><span class="s1"> seconds</span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="s1">&#39;Emersion time:  </span><span class="si">{}</span><span class="s1"> UTC +/- </span><span class="si">{:.3f}</span><span class="s1"> seconds</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">immersion</span><span class="o">.</span><span class="n">iso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">immersion_err</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">emersion</span><span class="o">.</span><span class="n">iso</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emersion_err</span><span class="p">)</span>
                       <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Immersion and emersion times were not fitted or instantiated.</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;Monte Carlo chi square fit.</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisquare</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; When this object is deleted, it removes the name from the Class name list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, SORA Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>